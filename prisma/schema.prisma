generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           Int    @id @default(autoincrement())
  name         String @unique
  email        String @unique
  passwordHash String
  createdAt    DateTime @default(now())

  decks           Deck[]
  loginTokens     LoginToken[]
  RssSubscription RssSubscription[]
  RssImpression   RssImpression[]
  CardImpression  CardImpression[]
}

model LoginToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  createdAt DateTime @default(now())
  valid     Boolean  @default(true)

  owner   User @relation(fields: [ownerId], references: [id])
  ownerId Int
}

model Deck {
  id      Int     @id @default(autoincrement())
  deleted Boolean @default(false)
  createdAt DateTime @default(now())

  name  String
  cards Card[]

  author   User @relation(fields: [authorId], references: [id])
  authorId Int
}

model Card {
  id      Int     @id @default(autoincrement())
  front   String
  back    String
  deleted Boolean @default(false)
  createdAt DateTime @default(now())

  deck           Deck             @relation(fields: [deckId], references: [id])
  deckId         Int
  impressions    CardImpression[]
}

model CardImpression {
  id         Int      @id @default(autoincrement())
  date       DateTime @default(now())
  timeSpent  Float
  resolution String

  user   User @relation(fields: [userId], references: [id])
  userId Int

  card   Card @relation(fields: [cardId], references: [id])
  cardId Int
}

model RssSubscription {
  id      Int     @id @default(autoincrement())
  deleted Boolean @default(false)

  user   User @relation(fields: [userId], references: [id])
  userId Int

  feed   RssFeed @relation(fields: [feedId], references: [id])
  feedId Int
}

model RssFeed {
  id              Int               @id @default(autoincrement())
  rssUrl          String
  lastSync        DateTime
  RssSubscription RssSubscription[]
}

model RssItem {
  id            Int             @id @default(autoincrement())
  title         String
  link          String
  content       String
  RssImpression RssImpression[]
}

model RssImpression {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id])

  rssItemId Int
  rssItem   RssItem @relation(fields: [rssItemId], references: [id])
}
